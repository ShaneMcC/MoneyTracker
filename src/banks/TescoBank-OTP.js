if(typeof String.prototype.trim!=="function"){String.prototype.trim=function(){return this.replace(/^\s+|\s+$/g,"")}}if(typeof String.prototype.startsWith!=="function"){String.prototype.startsWith=function(b){return this.indexOf(b)==0}}String.prototype.getHostname=function(){var b=new RegExp("^(?:f|ht)tp(?:s)?://([^/]+)","im");return this.match(b)[1].toString()};function IsNumeric(b){if(isNaN(parseFloat(b))){return false}return true}function checkValidExpiry(d){valid=true;var c=new Date();if(d!=null){if(!IsNumeric(d)){throw"E_PROC_XML"}if(!(Number(d)>0)){throw"E_WRONG_TIMESTAMP"}c.setTime(Number(d)*1000);if(c.getTime()<(new Date()).getTime()){throw"E_CARD_EXPIRED"}}return valid}function includeJS(e){var d=document.createElement("script");d.type="text/javascript";var f=document.getElementsByTagName("head");if(f&&f[0]){f[0].appendChild(d)}d.src=e;return d}var aotp_domainname=window.location.hostname;var aotp_default_stores=new Array();var aotp_defined_stores=new Array();aotp_defined_stores[0]=new StoreLocalImpl();aotp_defined_stores[1]=new Store();function OTP(d,c){if(d!=null){this.store=d}else{this.store=aotp_getDefaultStore()}if(c!=null){this.devicelocker=c}else{this.devicelocker=new DeviceLock()}this.fallbackEnabled=true}OTP.prototype.getVersion=function(){var b="ArcotOTP 1.3.4";return b};OTP.prototype.init=function(b){includeJS(b+"/js/arcot/util.js");includeJS(b+"/js/arcot/cookies.js");includeJS(b+"/js/arcot/emv.js");includeJS(b+"/js/ext/terodes.js");includeJS(b+"/js/arcot/crypto.js");includeJS(b+"/js/ext/prng4.js");includeJS(b+"/js/ext/rng.js");includeJS(b+"/js/ext/sha1.js");includeJS(b+"/js/arcot/hotp.js")};OTP.prototype.setDeviceLock=function(b){this.devicelocker=b};OTP.prototype.setStore=function(b){this.store=b};OTP.prototype.setFallBackEnabled=function(b){this.fallbackEnabled=b};OTP.prototype.deleteAccount=function deleteAccount(d){if(d==null){throw"E_WRONG_ACCOUNT"}if(d.trim().length==0){throw"E_WRONG_ACCOUNT"}d=d.toLowerCase();var e=null;if(this.store==null){throw"E_STORE_ACCESS"}else{try{var f=this.getAccount(d);if(f!=null){this.store.remove(f.id)}else{throw"E_WRONG_ACCOUNT"}}catch(e){throw e}}};OTP.prototype.provisionAccount=function provisionAccount(s,v,x,o){var m=null;var q=null;var p=null;var u=otp_parseXml(s);if(u==null){throw"E_PROC_XML"}if(v!=null&&v.trim().length>0){u.provUrl=v;try{u.ns=v.getHostname()}catch(r){u.ns=window.location.hostname}}if(u.id==null){u.id="aotpx_"+u.accountId.toLocaleLowerCase()}checkValidExpiry(u.expiryTime);var w=aotp_getCard(u.card);var n=new Array();if((x!=null&&x.trim().length>0)&&(o!=null&&o.trim().length>=0)){n[0]=x;w.decamouflage(n);n[0]=o;if(this.devicelocker!=null&&this.devicelocker.getKey()!=null&&this.devicelocker.getKey().trim().length>0){n[1]=this.devicelocker.getKey().trim()}w.camouflage(n)}else{if((x==null||x.trim().length==0)&&(o!=null&&o.trim().length>=0)){w.pdk=w.udk;n[0]=o;if(this.devicelocker!=null&&this.devicelocker.getKey()!=null&&this.devicelocker.getKey().trim().length>0){n[1]=this.devicelocker.getKey().trim()}w.camouflage(n)}else{if((x!=null&&x.trim().length>0)&&(o==null)){throw"E_WRONG_PIN"}else{if(this.devicelocker!=null&&this.devicelocker.getKey()!=null&&this.devicelocker.getKey().trim().length>0){n[0]=this.devicelocker.getKey().trim();w.camouflage(n)}}}}u.card=w.toString();this.saveAccount(u);return u};function otp_parseXml(x){var A=new Account();var p=new Date();A.provUrl=null;if(x==null){throw"E_BAD_XML"}if(x.trim().length==0){throw"E_BAD_XML"}x=x.trim();var o=null;var q=null;try{q=util_xmlSimpleGetContentByTagName(x,"status")}catch(n){throw"E_BAD_XML"}if(q==null){throw"E_BAD_XML"}if(!(q.toLowerCase()=="success")){try{msg=util_xmlSimpleGetContentByTagName(x,"message");throw msg}catch(s){throw"E_PROC_XML"}throw"E_PROC_XML"}A.tokenVersion=null;try{A.tokenVersion=util_xmlSimpleGetContentByTagName(x,"tokenVersion")}catch(u){throw"E_BAD_XML"}A.accountId=null;try{A.accountId=util_xmlSimpleGetContentByTagName(x,"aid")}catch(u){throw"E_BAD_XML"}A.card=null;try{A.card=util_xmlSimpleGetContentByTagName(x,"cs")}catch(y){throw"E_BAD_XML"}if(A.accountId==null||A.accountId.trim().length==0){throw"E_BAD_ID"}if(A.card==null||(A.card.trim().length==0)){throw"E_BAD_CS"}try{A.algo=util_xmlSimpleGetContentByTagName(x,"algoType")}catch(v){throw"E_BAD_ALGO"}if(A.algo==null||(!((A.algo=="HOTP")||(A.algo=="TOTP")||(A.algo=="EMV")))){throw"E_BAD_ALGO"}try{A.expiryTime=util_xmlSimpleGetContentByTagName(x,"expiry")}catch(v){}if(A.expiryTime==null||A.expiryTime.trim().length==0){A.expiryTime=String((new Date().getTime()+315360000000)/1000).toString()}try{A.creationTime=util_xmlSimpleGetContentByTagName(x,"creationTime")}catch(w){}try{A.lastUsed=util_xmlSimpleGetContentByTagName(x,"lastUsed")}catch(w){}try{A.logoUrl=util_xmlSimpleGetContentByTagName(x,"logoUrl")}catch(w){}try{A.provUrl=util_xmlSimpleGetContentByTagName(x,"provUrl")}catch(w){}if(A.provUrl!=null&&A.provUrl.trim().length>0){A.ns=A.provUrl.getHostname()}try{A.name=util_xmlSimpleGetContentByTagName(x,"displayName")}catch(w){}var r=ACard.ParseValue(A.card,"ORG_","",String,"E_DEF_UNKNOWN");if(r!=null&&r.trim().length>=0){A.org=r}try{A.uses=util_xmlSimpleGetContentByTagName(x,"uses")}catch(w){}try{A.ns=util_xmlSimpleGetContentByTagName(x,"ns")}catch(w){}if(A.ns==null){A.ns=window.location.hostname}try{A.id=util_xmlSimpleGetContentByTagName(x,"id")}catch(w){}if(A.creationTime==null){A.creationTime=String((new Date()).getTime())}return A}function aotp_xmlescape(c){var d=new String(c);return d}function otp_createXml(y){var v=null;var p=null;var x=null;var r=null;if(y.uses==x){y.uses="0"}var w=" ";if(y.lastUsed==null){y.lastUsed="NA"}if(y.accountId!=null){w=y.accountId}else{w=" "}w=w.toLowerCase();var u=" ";if(y.name!=null){u=y.name}else{u=" "}var n=" ";if(y.logoUrl!=null){n=y.logoUrl}else{n=" "}var A=" ";if(y.provUrl!=null){A=y.provUrl}else{A=" "}var B=" ";if(y.expiryTime!=null){B=y.expiryTime}else{B=" "}var q=" ";var s=" ";if(y.card!=null){q=aotp_getCardType(y.card);s=y.card}else{q=" ";s=" "}var o=" ";if(y.tokenVersion!=null){o=y.tokenVersion}else{o=" "}v='<?xml version="1.0" encoding="UTF-8"?><response xmlns="http://xs.arcot.com/ArcotOTPProtocolSvc/1.0"><status>success</status><reqid>1</reqid><aid>'+arcototp_escapeXMLSPChar(w)+"</aid><displayName>"+arcototp_escapeXMLSPChar(u)+"</displayName><logoUrl>"+arcototp_escapeXMLSPChar(n)+"</logoUrl><expiry>"+arcototp_escapeXMLSPChar(String(B))+"</expiry><algo><algoType>"+arcototp_escapeXMLSPChar(String(q))+"</algoType><provUrl>"+arcototp_escapeXMLSPChar(String(A))+"</provUrl><cs>"+arcototp_escapeXMLSPChar(String(s))+"</cs></algo><uses>"+arcototp_escapeXMLSPChar((String(y.uses)))+"</uses><lastUsed>"+arcototp_escapeXMLSPChar(String(y.lastUsed))+"</lastUsed><id>"+arcototp_escapeXMLSPChar(String(y.id))+"</id><tokenVersion>"+arcototp_escapeXMLSPChar(y.tokenVersion)+"</tokenVersion><ns>"+arcototp_escapeXMLSPChar(String(y.ns))+"</ns><version>"+arcototp_escapeXMLSPChar(String("1.0"))+"</version></response>";return v}OTP.prototype.saveTestCard=function saveTestCard(k,n,l,j){var m=new Account();if(k==null){throw"E_PROC_XML"}if(n==null){throw"E_PROC_XML"}var o=aotp_getCard(n);var h=new Array();h[0]=l;o.decamouflage(h);h[0]=j;if(this.devicelocker!=null&&this.devicelocker.getKey()!=null&&this.devicelocker.getKey().trim().length>0){h[1]=this.devicelocker.getKey().trim()}o.camouflage(h);m.expiryTime=((new Date()).setDate(new Date().getDate()+365));m.accountId=k;m.card=o.toString();m.ns=window.location.hostname;m.id=k;this.saveAccount(m)};OTP.prototype.saveRawCard=function saveRawCard(g,e){var h=new Account();if(g==null){throw"E_PROC_XML"}if(e==null){throw"E_PROC_XML"}var f=aotp_getCard(e);h.expiryTime=((new Date()).setDate(new Date().getDate()+365));h.accountId=g;h.card=f.toString();h.ns=window.location.hostname;h.id=g;this.saveAccount(h)};OTP.prototype.getFullProvisioningURL=function getFullProvisioningURL(b){throw"not supported"};OTP.prototype.saveAccount=function saveAccount(b){if(this.store==null){throw"E_STORE_WRITE"}if(b==null){throw"E_WRONG_ACCOUNT"}if(!(b instanceof Account)){throw"E_WRONG_ACCOUNT"}if(b.id==null){throw"E_WRONG_ACCOUNT"}if(b.id.trim().length==0){throw"E_WRONG_ACCOUNT"}if(!(b.id.indexOf("aotpx_")==0)){b.id="aotpx_"+util_tstring2hex(b.id.toLocaleLowerCase())}this.store.save(b)};OTP.prototype.getAccount=function getAccount(f){if(f==null){throw"E_WRONG_ACCOUNT"}if(f.trim().length==0){throw"E_WRONG_ACCOUNT"}f=f.toLowerCase();if(!(f.indexOf("aotpx_")==0)){f="aotpx_"+util_tstring2hex(f.toLocaleLowerCase())}var k=null;try{k=this.store.load(f);if(k==null){if(this.fallbackEnabled){var g=aotp_getNextRightStore(this.store,f);if(g!=null){this.store=g;k=g.load(f)}}}}catch(h){if(h="E_WRONG_ACCOUNT"){if(this.fallbackEnabled){var g=aotp_getNextRightStore(this.store,f);if(g!=null){this.store=g;try{k=g.load(f)}catch(j){throw j}}}}}return k};OTP.prototype.getAllAccounts=function getAllAccounts(){var b=this.store.loadAll();if(b==null||b.length<=0){if(this.fallbackEnabled){this.store=aotp_getNextRightStore(this.store,null);b=this.store.loadAll()}}return b};OTP.prototype.setStore=function setStore(b){this.store=b};OTP.prototype.generateOTPUsingAccount=function generateOTPUsingAccount(o,s,m){var l=null;var p=null;var n=new Date();checkValidExpiry(o.expiryTime);if(o.card==null){throw"E_STORE_LOAD"}var q=aotp_getCard(o.card);var r=aotp_getCardType(o.card);if(s==null){throw"E_WRONG_PIN"}var k=new Array();k[0]=s;if(this.devicelocker!=null&&this.devicelocker.getKey()!=null&&this.devicelocker.getKey().trim().length>0){k[1]=this.devicelocker.getKey().trim()}if(r=="HOTP"||r=="TOTP"){if(r=="TOTP"&&m!=null&&(m.time!=null)){p=m.time;if(p!=null){if(!(IsNumeric(p))){throw"E_WRONG_TIMESTAMP"}else{if(!(Number(p)>0)){throw"E_WRONG_TIMESTAMP"}}}}else{if(m!=null&&(m.atvalue!=null)){p=m.atvalue}}if(p!=null){l=q.genDynPasscodeAt(k,p)}else{l=q.genDynPasscode(k)}}else{}o.lastUsed=String((new Date()).getTime());if(o.uses==null){o.uses="1"}else{o.uses=String((Number(o.uses))+1)}o.card=q.toString();return l};OTP.prototype.generateOTP=function generateOTP(f,g,k){if(f==null){throw"E_WRONG_ACCOUNT"}if(f.trim().length==0){throw"E_WRONG_ACCOUNT"}var h=null;var j=this.getAccount(f);h=this.generateOTPUsingAccount(j,g,k);return h};OTP.prototype.generateOTPAt=function generateOTPAt(s,v,o,l){if(s==null){throw"E_WRONG_ACCOUNT"}if(s.trim().length==0){throw"E_WRONG_ACCOUNT"}var n=null;var q=this.getAccount(s);var p=new Date();checkValidExpiry(q.expiryTime);if(q.card==null){throw"E_STORE_LOAD"}var r=aotp_getCard(q.card);var u=aotp_getCardType(q.card);if(v==null){throw"E_WRONG_PIN"}var m=new Array();m[0]=v;if(this.devicelocker!=null&&this.devicelocker.getKey()!=null&&this.devicelocker.getKey().trim().length>0){m[1]=this.devicelocker.getKey().trim()}if(u=="HOTP"||u=="TOTP"){if(l==null||l.trim().length==0){n=r.genDynPasscode(m)}else{if(!(IsNumeric(l))){throw"E_WRONG_TIMESTAMP"}else{if(!(Number(l)>0)){throw"E_WRONG_TIMESTAMP"}}n=r.genDynPasscodeAt(m,l)}}else{}q.lastUsed=String((new Date()).getTime());if(q.uses==null){q.uses="1"}else{q.uses=String((Number(q.uses))+1)}q.card=r.toString();this.saveAccount(q);return n};OTP.prototype.resetPin=function resetPin(m,k,j){if(m==null){throw"E_WRONG_ACCOUNT"}if(m.trim().length==0){throw"E_WRONG_ACCOUNT"}m=m.toLowerCase();var l=this.getAccount(m);if(l.card==null){throw"E_WRONG_ACCOUNT"}var g=aotp_getCard(l.card);if(g==null){throw"E_STORE_ACCESS"}var h=new Array();if((k!=null&&k.trim().length>=0)&&(j!=null&&j.trim().length>=0)){h[0]=k;if(this.devicelocker!=null&&this.devicelocker.getKey()!=null&&this.devicelocker.getKey().trim().length>0){h[1]=this.devicelocker.getKey().trim()}g.decamouflage(h);h[0]=j;if(this.devicelocker!=null&&this.devicelocker.getKey()!=null&&this.devicelocker.getKey().trim().length>0){h[1]=this.devicelocker.getKey().trim()}g.camouflage(h)}else{throw"E_WRONG_PIN"}l.card=g.toString();this.saveAccount(l)};function Store(){}Store.prototype.load=function load(e){var f=null;var d=null;d=cookies_getCookie(e);if(d==null||d.trim().length==0){throw"E_WRONG_ACCOUNT"}if(d!=null&&d.trim().length>0){f=readCookieContent(d)}return f};function readCookieContent(c){var d=new Account();var e=String(c);d.tokenVersion=e.substring(0,e.indexOf("::"));if(d.tokenVersion==null||d.tokenVersion.trim().length==0){throw"E_BAD_TKNVN"}d.card=e.substring(e.indexOf("::")+2,e.length);if(d.card==null||(d.card.trim().length==0)){throw"E_BAD_CS"}var f=ACard.ParseValue(d.card,"USER","",String,"E_DEF_UNKNOWN");d.accountId=f.toLowerCase();if(d.accountId==null||d.accountId.trim().length==0){throw"E_BAD_ACCID"}d.org=ACard.ParseValue(d.card,"ORG_","",String,"E_DEF_UNKNOWN");d.id="aotpx_"+f.toLocaleLowerCase();return d}Store.prototype.loadAll=function loadAll(){var f=null;f=cookies_getAllCookies();var e=new Array();var d=0;if(f!=null){for(i=0;i<f.length;i++){if(f[i].indexOf("VER_")!=-1&&f[i].indexOf("TVAR")!=-1){e[d]=readCookieContent(f[i]);d++}}}return e};Store.prototype.save=function save(h){var f=9150;var g=0;var e=createCookieContent(h);cookies_setCookie(h.id,e,f,g)};function createCookieContent(b){var a=b.tokenVersion+"::"+b.card;return a}Store.prototype.getType=function getType(){return"cookie"};Store.prototype.remove=function remove(d){var e=180;var f=0;if(d!=null){cookies_setCookie(d,null,0,f)}};function StoreLocalImpl(){try{var d=localStorage.length}catch(c){}}StoreLocalImpl.prototype.load=function(e){var f=null;var d=null;d=localStorage.getItem(e);if(d==null){throw"E_WRONG_ACCOUNT"}f=otp_parseXml(d);return f};StoreLocalImpl.prototype.getType=function(){return"localstorage"};StoreLocalImpl.prototype.loadAll=function(){var o=null;var j=0;var q=0;var p=null;try{if(typeof(localStorage)=="undefined"){throw"E_UNSUPPORTED_STORAGE"}}catch(l){throw"E_UNSUPPORTED_STORAGE"}try{p=localStorage.key(j)}catch(m){p=null}var k=new Array();while(p!=null&&j<999999){anyval=localStorage.getItem(p);if(anyval!=null&&anyval.indexOf("<?xml")>=0&&anyval.indexOf("http://xs.arcot.com/ArcotOTPProtocolSvc/1.0")>=0){k[q]=otp_parseXml(anyval);q++}j++;try{p=localStorage.key(j)}catch(n){break}}return k};StoreLocalImpl.prototype.save=function(c){var d=otp_createXml(c);document.getElementById("STORAGE_TYPE").value="LocalStorage";localStorage.setItem(c.id,d)};StoreLocalImpl.prototype.remove=function(b){if(b!=null){localStorage.removeItem(b)}};function DeviceLock(){}DeviceLock.prototype.getKey=function getKey(){return""};function aotp_getCardType(c){var d=null;d=ACard.ParseValue(c,"TYPE","",String,"E_DEF_UNKNOWN");return d}function aotp_getCard(f){var e=null;var d=aotp_getCardType(f);if(d=="HOTP"){e=new Hotp(f)}else{if(d=="TOTP"){e=new Totp(f)}else{if(d=="VISA"){e=null;throw"E_UNSUPPORTED_CARD"}else{if(d=="MC"){e=null;throw"E_UNSUPPORTED_CARD"}else{throw"E_UNSUPPORTED_CARD"}}}}return e}function Account(){this.accountId=null;this.id=null;this.algo=null;this.card=null;this.ns=null;this.expiryTime=null;this.lastUsed=null;this.logoUrl=null;this.name=null;this.org=null;this.provUrl=null;this.uses=null;this.creationTime=null;this.tokenVersion=null}Account.prototype.getTokenVersion=function(){return this.tokenVersion};Account.prototype.getId=function(){return this.id};Account.prototype.getAttribute=function getAttribute(h){var f=null;if(h==null||h.trim().length==0){throw"E_WRONG_KEY"}var g=h.toUpperCase();var e=aotp_getCard(this.card);f=ACard.getField(e.aotpallfields,g,null,null,"E_DEF_UNKNOWN");return f};Account.prototype.setAttribute=function setAttribute(k,l){var g=null;var h=new String(l);if(k==null||k.trim().length==0){throw"E_BAD_ATTR"}if((k.indexOf(":")>=0)||(k.indexOf("=")>=0)||ACard.isReserved(k)){throw"E_BAD_ATTR"}var j=k.toUpperCase();var m=aotp_getCard(this.card);m.aotpallfields[j]=String(l);this.card=m.toString()};Account.prototype.getAttributeNames=function getAttributeNames(){var e=new Array();var h=null;var f=0;var g=aotp_getCard(this.card);for(h in g.aotpallfields){e[f]=h;f++}return e};function trimAll(b){while(b.substring(0,1)==" "){b=b.substring(1,b.length)}while(b.substring(b.length-1,b.length)==" "){b=b.substring(0,b.length-1)}return b}function aotp_getDefaultStore(){var h=null;var j=0;var f=0;for(j=0;j<aotp_defined_stores.length;j++){if(aotp_defined_stores[j].getType()=="localstorage"){try{if(!(typeof(localStorage)=="undefined")){localStorage.setItem("teststore","1");if((localStorage.getItem("teststore")=="1")){aotp_default_stores[f]=aotp_defined_stores[j];f++}localStorage.removeItem("teststore");document.getElementById("DIAGNOSTICS").value+="Localstorage is supported"}}catch(k){}}else{if(aotp_defined_stores[j].getType()=="cookie"){try{cookies_setCookie("teststore","1",1,0);cardstring=cookies_getCookie("teststore");if((cookies_getCookie("teststore")=="1")){aotp_default_stores[f]=aotp_defined_stores[j];f++}cookies_setCookie("teststore",null,0,0);document.getElementById("DIAGNOSTICS").value+="Cookies are supported"}catch(g){}}}}if(aotp_default_stores.length>0){h=aotp_default_stores[0]}else{throw"No stores are valid"}return h}function aotp_getNextRightStore(r,x){var n=r;var j=aotp_default_stores.length;var s=0,w=0;if(x!=null){try{if(r!=null&&r.load(x)!=null){n=r;return n}}catch(v){}}var p=null;if(r!=null){try{p=r.loadAll()}catch(u){p=null}if(p!=null&&p.length>0){return r}}for(s=0;s<j;s++){try{if(x!=null&&aotp_default_stores[s].load(x)!=null){n=aotp_default_stores[s];return n}else{try{p=aotp_default_stores[s].loadAll()}catch(o){p=null}if(p!=null){n=aotp_default_stores[s];return n}}}catch(q){}}return n}function des(j,X,af,V,am,P){var ae=new Array(16843776,0,65536,16843780,16842756,66564,4,65536,1024,16843776,16843780,1024,16778244,16842756,16777216,4,1028,16778240,16778240,66560,66560,16842752,16842752,16778244,65540,16777220,16777220,65540,0,1028,66564,16777216,65536,16843780,4,16842752,16843776,16777216,16777216,1024,16842756,65536,66560,16777220,1024,4,16778244,66564,16843780,65540,16842752,16778244,16777220,1028,66564,16843776,1028,16778240,16778240,0,65540,66560,0,16842756);var ag=new Array(-2146402272,-2147450880,32768,1081376,1048576,32,-2146435040,-2147450848,-2147483616,-2146402272,-2146402304,-2147483648,-2147450880,1048576,32,-2146435040,1081344,1048608,-2147450848,0,-2147483648,32768,1081376,-2146435072,1048608,-2147483616,0,1081344,32800,-2146402304,-2146435072,32800,0,1081376,-2146435040,1048576,-2147450848,-2146435072,-2146402304,32768,-2146435072,-2147450880,32,-2146402272,1081376,32,32768,-2147483648,32800,-2146402304,1048576,-2147483616,1048608,-2147450848,-2147483616,1048608,1081344,0,-2147450880,32800,-2147483648,-2146435040,-2146402272,1081344);var ah=new Array(520,134349312,0,134348808,134218240,0,131592,134218240,131080,134217736,134217736,131072,134349320,131080,134348800,520,134217728,8,134349312,512,131584,134348800,134348808,131592,134218248,131584,131072,134218248,8,134349320,512,134217728,134349312,134217728,131080,520,131072,134349312,134218240,0,512,131080,134349320,134218240,134217736,512,0,134348808,134218248,131072,134217728,134349320,8,131592,131584,134217736,134348800,134218248,520,134348800,131592,8,134348808,131584);var ai=new Array(8396801,8321,8321,128,8396928,8388737,8388609,8193,0,8396800,8396800,8396929,129,0,8388736,8388609,1,8192,8388608,8396801,128,8388608,8193,8320,8388737,1,8320,8388736,8192,8396928,8396929,129,8388736,8388609,8396800,8396929,129,0,0,8396800,8320,8388736,8388737,1,8396801,8321,8321,128,8396929,129,1,8192,8388609,8193,8396928,8388737,8193,8320,8388608,8396801,128,8388608,8192,8396928);var aj=new Array(256,34078976,34078720,1107296512,524288,256,1073741824,34078720,1074266368,524288,33554688,1074266368,1107296512,1107820544,524544,1073741824,33554432,1074266112,1074266112,0,1073742080,1107820800,1107820800,33554688,1107820544,1073742080,0,1107296256,34078976,33554432,1107296256,524544,524288,1107296512,256,33554432,1073741824,34078720,1107296512,1074266368,33554688,1073741824,1107820544,34078976,1074266368,256,33554432,1107820544,1107820800,524544,1107296256,1107820800,34078720,0,1074266112,1107296256,524544,33554688,1073742080,524288,0,1074266112,34078976,1073742080);var al=new Array(536870928,541065216,16384,541081616,541065216,16,541081616,4194304,536887296,4210704,4194304,536870928,4194320,536887296,536870912,16400,0,4194320,536887312,16384,4210688,536887312,16,541065232,541065232,0,4210704,541081600,16400,4210688,541081600,536870912,536887296,16,541065232,4210688,541081616,4194304,16400,536870928,4194304,536887296,536870912,16400,536870928,541081616,4210688,541065216,4210704,541081600,0,541065232,16,16384,541065216,4210704,16384,4194320,536887312,0,541081600,536870912,4194320,536887312);var an=new Array(2097152,69206018,67110914,0,2048,67110914,2099202,69208064,69208066,2097152,0,67108866,2,67108864,69206018,2050,67110912,2099202,2097154,67110912,67108866,69206016,69208064,2097154,69206016,2048,2050,69208066,2099200,2,67108864,2099200,67108864,2099200,2097152,67110914,67110914,69206018,69206018,2,2097154,67108864,67110912,2097152,69208064,2050,2099202,69208064,2050,67108866,69208066,69206016,2099200,0,2,69208066,0,2099202,69206016,2048,67108866,67110912,2048,2097154);var ap=new Array(268439616,4096,262144,268701760,268435456,268439616,64,268435456,262208,268697600,268701760,266240,268701696,266304,4096,64,268697600,268435520,268439552,4160,266240,262208,268697664,268701696,4160,0,0,268697664,268435520,268439552,266304,262144,266304,262144,268701696,4096,64,268697664,4096,266304,268439552,64,268435520,268697600,268697664,268435456,262144,268439616,0,268701760,262208,268435520,268697600,268439552,268439616,0,268701760,266240,266240,4160,4160,262208,268435456,268701696);var R=des_createKeys(j);var ac=0,T,W,O,m,aq,ar,ao,N,ad;var ab,Y,at,ak;var S,aa;var Q=X.length;var Z=0;var U=R.length==32?3:9;if(U==3){ad=af?new Array(0,32,2):new Array(30,-2,-2)}else{ad=af?new Array(0,32,2,62,30,-2,64,96,2):new Array(94,62,-2,32,64,2,30,-2,-2)}if(P==2){X+="        "}else{if(P==1){O=8-(Q%8);X+=String.fromCharCode(O,O,O,O,O,O,O,O);if(O==8){Q+=8}}else{if(!P){X+="\0\0\0\0\0\0\0\0"}}}result="";tempresult="";if(V==1){ab=(am.charCodeAt(ac++)<<24)|(am.charCodeAt(ac++)<<16)|(am.charCodeAt(ac++)<<8)|am.charCodeAt(ac++);at=(am.charCodeAt(ac++)<<24)|(am.charCodeAt(ac++)<<16)|(am.charCodeAt(ac++)<<8)|am.charCodeAt(ac++);ac=0}while(ac<Q){ao=(X.charCodeAt(ac++)<<24)|(X.charCodeAt(ac++)<<16)|(X.charCodeAt(ac++)<<8)|X.charCodeAt(ac++);N=(X.charCodeAt(ac++)<<24)|(X.charCodeAt(ac++)<<16)|(X.charCodeAt(ac++)<<8)|X.charCodeAt(ac++);if(V==1){if(af){ao^=ab;N^=at}else{Y=ab;ak=at;ab=ao;at=N}}O=((ao>>>4)^N)&252645135;N^=O;ao^=(O<<4);O=((ao>>>16)^N)&65535;N^=O;ao^=(O<<16);O=((N>>>2)^ao)&858993459;ao^=O;N^=(O<<2);O=((N>>>8)^ao)&16711935;ao^=O;N^=(O<<8);O=((ao>>>1)^N)&1431655765;N^=O;ao^=(O<<1);ao=((ao<<1)|(ao>>>31));N=((N<<1)|(N>>>31));for(W=0;W<U;W+=3){S=ad[W+1];aa=ad[W+2];for(T=ad[W];T!=S;T+=aa){aq=N^R[T];ar=((N>>>4)|(N<<28))^R[T+1];O=ao;ao=N;N=O^(ag[(aq>>>24)&63]|ai[(aq>>>16)&63]|al[(aq>>>8)&63]|ap[aq&63]|ae[(ar>>>24)&63]|ah[(ar>>>16)&63]|aj[(ar>>>8)&63]|an[ar&63])}O=ao;ao=N;N=O}ao=((ao>>>1)|(ao<<31));N=((N>>>1)|(N<<31));O=((ao>>>1)^N)&1431655765;N^=O;ao^=(O<<1);O=((N>>>8)^ao)&16711935;ao^=O;N^=(O<<8);O=((N>>>2)^ao)&858993459;ao^=O;N^=(O<<2);O=((ao>>>16)^N)&65535;N^=O;ao^=(O<<16);O=((ao>>>4)^N)&252645135;N^=O;ao^=(O<<4);if(V==1){if(af){ab=ao;at=N}else{ao^=Y;N^=ak}}tempresult+=String.fromCharCode((ao>>>24),((ao>>>16)&255),((ao>>>8)&255),(ao&255),(N>>>24),((N>>>16)&255),((N>>>8)&255),(N&255));Z+=8;if(Z==512){result+=tempresult;tempresult="";Z=0}}return result+tempresult}function des_createKeys(n){pc2bytes0=new Array(0,4,536870912,536870916,65536,65540,536936448,536936452,512,516,536871424,536871428,66048,66052,536936960,536936964);pc2bytes1=new Array(0,1,1048576,1048577,67108864,67108865,68157440,68157441,256,257,1048832,1048833,67109120,67109121,68157696,68157697);pc2bytes2=new Array(0,8,2048,2056,16777216,16777224,16779264,16779272,0,8,2048,2056,16777216,16777224,16779264,16779272);pc2bytes3=new Array(0,2097152,134217728,136314880,8192,2105344,134225920,136323072,131072,2228224,134348800,136445952,139264,2236416,134356992,136454144);pc2bytes4=new Array(0,262144,16,262160,0,262144,16,262160,4096,266240,4112,266256,4096,266240,4112,266256);pc2bytes5=new Array(0,1024,32,1056,0,1024,32,1056,33554432,33555456,33554464,33555488,33554432,33555456,33554464,33555488);pc2bytes6=new Array(0,268435456,524288,268959744,2,268435458,524290,268959746,0,268435456,524288,268959744,2,268435458,524290,268959746);pc2bytes7=new Array(0,65536,2048,67584,536870912,536936448,536872960,536938496,131072,196608,133120,198656,537001984,537067520,537004032,537069568);pc2bytes8=new Array(0,262144,0,262144,2,262146,2,262146,33554432,33816576,33554432,33816576,33554434,33816578,33554434,33816578);pc2bytes9=new Array(0,268435456,8,268435464,0,268435456,8,268435464,1024,268436480,1032,268436488,1024,268436480,1032,268436488);pc2bytes10=new Array(0,32,0,32,1048576,1048608,1048576,1048608,8192,8224,8192,8224,1056768,1056800,1056768,1056800);pc2bytes11=new Array(0,16777216,512,16777728,2097152,18874368,2097664,18874880,67108864,83886080,67109376,83886592,69206016,85983232,69206528,85983744);pc2bytes12=new Array(0,4096,134217728,134221824,524288,528384,134742016,134746112,16,4112,134217744,134221840,524304,528400,134742032,134746128);pc2bytes13=new Array(0,4,256,260,0,4,256,260,1,5,257,261,1,5,257,261);var s=n.length>8?3:1;var j=new Array(32*s);var o=new Array(0,0,1,1,1,1,1,1,0,1,1,1,1,1,1,0);var p,v,r=0,u=0,m;for(var q=0;q<s;q++){left=(n.charCodeAt(r++)<<24)|(n.charCodeAt(r++)<<16)|(n.charCodeAt(r++)<<8)|n.charCodeAt(r++);right=(n.charCodeAt(r++)<<24)|(n.charCodeAt(r++)<<16)|(n.charCodeAt(r++)<<8)|n.charCodeAt(r++);m=((left>>>4)^right)&252645135;right^=m;left^=(m<<4);m=((right>>>-16)^left)&65535;left^=m;right^=(m<<-16);m=((left>>>2)^right)&858993459;right^=m;left^=(m<<2);m=((right>>>-16)^left)&65535;left^=m;right^=(m<<-16);m=((left>>>1)^right)&1431655765;right^=m;left^=(m<<1);m=((right>>>8)^left)&16711935;left^=m;right^=(m<<8);m=((left>>>1)^right)&1431655765;right^=m;left^=(m<<1);m=(left<<8)|((right>>>20)&240);left=(right<<24)|((right<<8)&16711680)|((right>>>8)&65280)|((right>>>24)&240);right=m;for(i=0;i<o.length;i++){if(o[i]){left=(left<<2)|(left>>>26);right=(right<<2)|(right>>>26)}else{left=(left<<1)|(left>>>27);right=(right<<1)|(right>>>27)}left&=-15;right&=-15;p=pc2bytes0[left>>>28]|pc2bytes1[(left>>>24)&15]|pc2bytes2[(left>>>20)&15]|pc2bytes3[(left>>>16)&15]|pc2bytes4[(left>>>12)&15]|pc2bytes5[(left>>>8)&15]|pc2bytes6[(left>>>4)&15];v=pc2bytes7[right>>>28]|pc2bytes8[(right>>>24)&15]|pc2bytes9[(right>>>20)&15]|pc2bytes10[(right>>>16)&15]|pc2bytes11[(right>>>12)&15]|pc2bytes12[(right>>>8)&15]|pc2bytes13[(right>>>4)&15];m=((v>>>16)^p)&65535;j[u++]=p^m;j[u++]=v^(m<<16)}}return j}function Arcfour(){this.i=0;this.j=0;this.S=new Array()}function ARC4init(g){var h,f,e;for(h=0;h<256;++h){this.S[h]=h}f=0;for(h=0;h<256;++h){f=(f+this.S[h]+g[h%g.length])&255;e=this.S[h];this.S[h]=this.S[f];this.S[f]=e}this.i=0;this.j=0}function ARC4next(){var b;this.i=(this.i+1)&255;this.j=(this.j+this.S[this.i])&255;b=this.S[this.i];this.S[this.i]=this.S[this.j];this.S[this.j]=b;return this.S[(b+this.S[this.i])&255]}Arcfour.prototype.init=ARC4init;Arcfour.prototype.next=ARC4next;function prng_newstate(){return new Arcfour()}var rng_psize=256;var rng_state;var rng_pool;var rng_pptr;function rng_seed_int(b){rng_pool[rng_pptr++]^=b&255;rng_pool[rng_pptr++]^=(b>>8)&255;rng_pool[rng_pptr++]^=(b>>16)&255;rng_pool[rng_pptr++]^=(b>>24)&255;if(rng_pptr>=rng_psize){rng_pptr-=rng_psize}}function rng_seed_time(){rng_seed_int(new Date().getTime())}if(rng_pool==null){rng_pool=new Array();rng_pptr=0;var t;if(navigator.appName=="Netscape"&&navigator.appVersion<"5"&&window.crypto){var z=window.crypto.random(32);for(t=0;t<z.length;++t){rng_pool[rng_pptr++]=z.charCodeAt(t)&255}}while(rng_pptr<rng_psize){t=Math.floor(65536*Math.random());rng_pool[rng_pptr++]=t>>>8;rng_pool[rng_pptr++]=t&255}rng_pptr=0;rng_seed_time()}function rng_get_byte(){if(rng_state==null){rng_seed_time();rng_state=prng_newstate();rng_state.init(rng_pool);for(rng_pptr=0;rng_pptr<rng_pool.length;++rng_pptr){rng_pool[rng_pptr]=0}rng_pptr=0}return rng_state.next()}function rng_get_bytes(c){var d;for(d=0;d<c.length;++d){c[d]=rng_get_byte()}}function SecureRandom(){}SecureRandom.prototype.nextBytes=rng_get_bytes;var hexcase=0;var b64pad="";var chrsz=8;function hex_sha1(b){return binb2hex(core_sha1(str2binb(b),b.length*chrsz))}function b64_sha1(b){return binb2b64(core_sha1(str2binb(b),b.length*chrsz))}function str_sha1(b){return binb2str(core_sha1(str2binb(b),b.length*chrsz))}function hex_hmac_sha1(d,c){return binb2hex(core_hmac_sha1(d,c))}function b64_hmac_sha1(d,c){return binb2b64(core_hmac_sha1(d,c))}function str_hmac_sha1(d,c){return binb2str(core_hmac_sha1(d,c))}function sha1_vm_test(){return hex_sha1("abc")=="a9993e364706816aba3e25717850c26c9cd0d89d"}function core_sha1(G,e){G[e>>5]|=128<<(24-e%32);G[((e+64>>9)<<4)+15]=e;var F=Array(80);var H=1732584193;var I=-271733879;var a=-1732584194;var b=271733878;var c=-1009589776;for(var x=0;x<G.length;x+=16){var j=H;var w=I;var B=a;var C=b;var E=c;for(var D=0;D<80;D++){if(D<16){F[D]=G[x+D]}else{F[D]=rol(F[D-3]^F[D-8]^F[D-14]^F[D-16],1)}var d=safe_add(safe_add(rol(H,5),sha1_ft(D,I,a,b)),safe_add(safe_add(c,F[D]),sha1_kt(D)));c=b;b=a;a=rol(I,30);I=H;H=d}H=safe_add(H,j);I=safe_add(I,w);a=safe_add(a,B);b=safe_add(b,C);c=safe_add(c,E)}return Array(H,I,a,b,c)}function sha1_ft(h,b,c,d){if(h<20){return(b&c)|((~b)&d)}if(h<40){return b^c^d}if(h<60){return(b&c)|(b&d)|(c&d)}return b^c^d}function sha1_kt(b){return(b<20)?1518500249:(b<40)?1859775393:(b<60)?-1894007588:-899497514}function core_hmac_sha1(o,l){var m=str2binb(o);if(m.length>16){m=core_sha1(m,o.length*chrsz)}var j=Array(16),n=Array(16);for(var h=0;h<16;h++){j[h]=m[h]^909522486;n[h]=m[h]^1549556828}var k=core_sha1(j.concat(str2binb(l)),512+l.length*chrsz);return core_sha1(n.concat(k),512+160)}function safe_add(f,g){var h=(f&65535)+(g&65535);var e=(f>>16)+(g>>16)+(h>>16);return(e<<16)|(h&65535)}function rol(d,c){return(d<<c)|(d>>>(32-c))}function str2binb(g){var h=Array();var f=(1<<chrsz)-1;for(var e=0;e<g.length*chrsz;e+=chrsz){h[e>>5]|=(g.charCodeAt(e/chrsz)&f)<<(32-chrsz-e%32)}return h}function binb2str(h){var g="";var f=(1<<chrsz)-1;for(var e=0;e<h.length*32;e+=chrsz){g+=String.fromCharCode((h[e>>5]>>>(32-chrsz-e%32))&f)}return g}function binb2hex(h){var e=hexcase?"0123456789ABCDEF":"0123456789abcdef";var g="";for(var f=0;f<h.length*4;f++){g+=e.charAt((h[f>>2]>>((3-f%4)*8+4))&15)+e.charAt((h[f>>2]>>((3-f%4)*8))&15)}return g}function binb2b64(l){var m="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/";var j="";for(var g=0;g<l.length*4;g+=3){var k=(((l[g>>2]>>8*(3-g%4))&255)<<16)|(((l[g+1>>2]>>8*(3-(g+1)%4))&255)<<8)|((l[g+2>>2]>>8*(3-(g+2)%4))&255);for(var h=0;h<4;h++){if(g*8+h*6>l.length*32){j+=b64pad}else{j+=m.charAt((k>>6*(3-h))&63)}}}return j}var util_gem_initial="";var util_global_error_msg=util_gem_initial;function util_checkError(){if(util_global_error_msg!=util_gem_initial){}return}var util_separator="::";function util_hex2tstring(g){if((g.length%2)!=0){return null}var h,f,e="";for(h=0;h<g.length;h+=2){f=parseInt(g.substring(h,h+2),16);e+=String.fromCharCode(f)}return e}function util_tstring2hex(f){var d="";var e;for(e=0;e<f.length;e++){d+=util_byte2hex(f.charCodeAt(e))}return d}function util_hex2bytes(f){if((f.length%2)!=0){return null}var g,h;var a=new Array();for(g=0;g<f.length;g+=2){h=parseInt(f.substring(g,g+2),16);a[g/2]=h}return a}function util_byte2hex(b){b&=255;if(b<16){return"0"+b.toString(16)}else{return b.toString(16)}}function util_bytes2hex(f){var d="";for(var e=0;e<f.length;e++){d+=util_byte2hex(f[e]&255)}return d}function util_tstring2bytes(e){var a=new Array();for(var f=0;f<e.length;f++){a[f]=e.charCodeAt(f)&255}return a}function util_bytes2tstring(a){return}function util_bitString2hex(f){if(!f.length){return""}var h="";var g=f.length%4;if(g){h+=parseInt(f.substr(0,g),2).toString(16)}for(var e=g;e<f.length;e+=4){h+=parseInt(f.substr(e,4),2).toString(16)}return h}function util_bitString2hex_num(g){var h=g.length;if(!h){return""}var j=0;for(j=0;j<h;j++){if(g.charAt(j)!="0"){break}}if(j==h){return"0"}var l="";var k=(h-j)%4;if(k){l+=parseInt(g.substr(j,k),2).toString(16)}for(var m=j+k;m<h;m+=4){l+=parseInt(g.substr(m,4),2).toString(16)}return l}function util_hex2bitString(j){var g=j.length;var h=["000","00","0",""];var k="";var m;for(var l=0;l<g;l++){m=parseInt(j.charAt(l),16).toString(2);k+=h[m.length-1]+m}return k}function util_hex2bitString_num(b){}function flip(c){var d="f0F0e1E1d2D2c3C3b4B4a5A5696787";return d.charAt(d.indexOf(c)+1)}function util_flipBits(f){var d="";for(var e=0;e<f.length;e++){d+=flip(f.charAt(e))}return d}function util_isHex(b){return true}function util_isBd(b){return true}function arcototp_xmlSimpleUnescape(b){if(b==null){throw"Argument was null string"}if(b.indexOf("<")!=-1){throw"Illegal < char found in raw (pre-unescaped) xml content"}if(b.indexOf("&")==-1){return b}return b.replace("&amp;","&").replace("&apos;","'").replace("&quot;",'"').replace("&lt;","<").replace("&gt;",">")}function arcototp_escapeXMLSPChar(b){if(b==null){return b}return b.replace("&","&amp;").replace("'","&apos;").replace('"',"&quot;").replace("<","&lt;").replace(">","&gt;")}function util_xmlSimpleGetContentByTagName(l,k){if(l==null){throw"xmlstring argument was null string"}if(k==null){throw"tag argument was null string"}var n=String(k);if(n.length==0){throw"tag argument had length 0"}var n="<"+String(n)+">";var h="</"+n.substring(1,n.length);var o=0,j=0;o=l.indexOf(n);if(o==-1){return null}j=l.indexOf(h,o+n.length);if(j==-1){throw"Bad xml: found begin tag but missing end tag"}var m=l.substring(o+n.length,j);return arcototp_xmlSimpleUnescape(m)}function util_xmlSimpleSaveContentByTagName(k,h,j){if(k==null){throw"xmlstring argument was null string"}if(h==null){throw"tag argument was null string"}if(h.length==0){throw"tag argument had length 0"}h="<"+h+">";var n="</"+h.substring(1,h.length);var l=0,o=0;l=k.indexOf(h);if(l==-1){return null}o=k.indexOf(n,l+h.length);if(o==-1){throw"Bad xml: found begin tag but missing end tag"}var m=new String();m=m+k.substring(0,l+h.length);m=m+j;m=m+k.substring(o,k.length);return String(m)}function cookies_setCookie(f,k,g,h){var j=new Date();j.setDate(j.getDate()+g);if(k!=null&&k.length>0){document.cookie=f+"="+escape(k)+((g)?";expires="+j.toGMTString():"")+((h)?"; secure":"")}else{document.cookie=f+"="+((g)?";expires="+j.toGMTString():"")+((h)?"; secure":"")}document.getElementById("STORAGE_TYPE").value="Cookie";return}function cookies_getCookie(c){var f=document.cookie.split(";");var g;for(var h=0;h<f.length;h++){g=f[h];while(g.charAt(0)==" "){g=g.substring(1,g.length)}if(g.indexOf(c+"=")==0){return unescape(g.substring(c.length+1,g.length))}}return null}function cookies_getAllCookies(){var k=new Array();var h=document.cookie.split(";");var j;var c=0;for(var m=0;m<h.length;m++){j=h[m];while(j.charAt(0)==" "){j=j.substring(1,j.length)}var l=j.split("=");if(l!=null&&l[1]!=null){k[c]=unescape(l[1]);c++}}return k}function cookies_eraseCookie(b){cookies_createCookie(b,"",-1)}cookies_fragmentSize=500;function cookies_fileWrite(d,f,e){return 0}function cookies_fileRead(b){return"data"}var cardVersion="0.1";var separator=util_separator;function emv_card(G,x,A,M,D,F,w,H,J,E,y,B,O,P,Q,K,L,C,I,N){this.AmountAuthorized=G;this.AmountOther=x;this.TermCountryCode=A;this.TermVerifRes=M;this.TransCurrencyCode=D;this.TransDate=F;this.TransType=w;this.UnpredNumber=H;this.AppInterProfile=J;this.AppTransCtr=E;this.CardVerifRes=y;this.PAN=B;this.PANSequence=O;this.udka=P;this.udkb=Q;this.pdka=K;this.pdkb=L;this.CryptogramInfData=C;this.IssuerAppData=I;this.IssuerPropBitmap=N}function emv_cardToString(c){var d="";d+="AA__=";d+=c.AmountAuthorized;d+=separator;d+="AO__=";d+=c.AmountOther;d+=separator;d+="TECC=";d+=c.TermCountryCode;d+=separator;d+="TVR_=";d+=c.TermVerifRes;d+=separator;d+="TRCC=";d+=c.TransCurrencyCode;d+=separator;d+="TD__=";d+=c.TransDate;d+=separator;d+="TT__=";d+=c.TransType;d+=separator;d+="UN__=";d+=c.UnpredNumber;d+=separator;d+="AIP_=";d+=c.AppInterProfile;d+=separator;d+="ATC_=";d+=c.AppTransCtr;d+=separator;d+="CVR_=";d+=c.CardVerifRes;d+=separator;d+="UDKA=";d+=c.udka;d+=separator;d+="UDKB=";d+=c.udkb;d+=separator;d+="CID_=";d+=c.CryptogramInfData;d+=separator;d+="IAD_=";d+=c.IssuerAppData;d+=separator;d+="IPB_=";d+=c.IssuerPropBitmap;d+=separator;return d}function emv_checkCard(d){var c=0;if(!d){util_global_error_msg+="::Error in emv_checkChard(): input card null or undefined.";return}if(d.AmountAuthorized.length!=12){c++}if(d.AmountAuthorized=="undefined"){c++}if(d.AmountAuthorized==null){c++}if(typeof d.AmountAuthorized=="undefined"){c++}if(!util_isHex(d.AmountAuthorized)){c++}if(c>0){util_global_error_msg+="::Error in emv_checkCard()"}return}function emv_stringToCard(h){var m=null;var g=new emv_card();var k;getdata:{k=h.indexOf("AA__=");if(k>=0){g.AmountAuthorized=h.substr(k+5,12)}else{m="No AmountAuthorized found in card";break getdata}k=h.indexOf("AO__=");if(k>=0){g.AmountOther=h.substr(k+5,12)}else{m="No AmountOther found in card";break getdata}k=h.indexOf("TECC=");if(k>=0){g.TermCountryCode=h.substr(k+5,4)}else{m="No TermCountryCode found in card";break getdata}k=h.indexOf("TVR_=");if(k>=0){g.TermVerifRes=h.substr(k+5,10)}else{m="No TermVerifRes found in card";break getdata}k=h.indexOf("TRCC=");if(k>=0){g.TransCurrencyCode=h.substr(k+5,4)}else{m="No TransCurrencyCode found in card";break getdata}k=h.indexOf("TD__=");if(k>=0){g.TransDate=h.substr(k+5,6)}else{m="No TransDate found in card";break getdata}k=h.indexOf("TT__=");if(k>=0){g.TransType=h.substr(k+5,2)}else{m="No TransType found in card";break getdata}k=h.indexOf("UN__=");if(k>=0){g.UnpredNumber=h.substr(k+5,8)}else{m="No UnpredNumber found in card";break getdata}k=h.indexOf("AIP_=");if(k>=0){g.AppInterProfile=h.substr(k+5,4)}else{m="No AppInterProfile found in card";break getdata}k=h.indexOf("ATC_=");if(k>=0){g.AppTransCtr=h.substr(k+5,4)}else{m="No AppTransCtr found in card";break getdata}k=h.indexOf("CVR_=");if(k>=0){g.CardVerifRes=h.substr(k+5,8)}else{m="No CardVerifRes found in card";break getdata}k=h.indexOf("UDKA=");if(k>=0){g.udka=h.substr(k+5,16)}k=h.indexOf("UDKB=");if(k>=0){g.udkb=h.substr(k+5,16)}k=h.indexOf("PDKA=");if(k>=0){g.pdka=h.substr(k+5,16)}k=h.indexOf("PDKB=");if(k>=0){g.pdkb=h.substr(k+5,16)}k=h.indexOf("CID_=");if(k>=0){g.CryptogramInfData=h.substr(k+5,2)}else{m="No CryptogramInfData found in card";break getdata}k=h.indexOf("IAD_=");if(k>=0){g.IssuerAppData=h.substr(k+5,14)}else{m="No IssuerAppData found in card";break getdata}k=h.indexOf("IPB_=");if(k>=0){g.IssuerPropBitmap=h.substr(k+5,36)}else{m="No IssuerPropBitmap found in card";break getdata}}if(m!=null){util_global_error_msg="Error in emv_stringToCard(): "+m;return null}var l=!!g.udka&&!!g.udkb;var j=!!g.pdka&&!!g.pdkb;if(!!"foo"+!!"bar"!=2){return null}if((l+j)!=1){m="Unexpected combination of plain and camouflaged keys";util_global_error_msg="Error in emv_stringToCard(): "+m;return null}return g}function emv_camCard(d,c){if(!d.pdka||!d.pdkb){util_global_error_msg+="::Error in emv_camCard(): missing plain key.";return}d.udka=crypto_camDES(d.pdka,c);d.udkb=crypto_camDES(d.pdkb,c);return}function emv_decamCard(d,c){if(!d.udka||!d.udkb){util_global_error_msg+="::Error in emv_decamCard(): missing camouflaged key.";return}d.pdka=crypto_decamDES(d.udka,c);d.pdkb=crypto_decamDES(d.udkb,c);return}function emv_genARQC(e){var f=e.AmountAuthorized+e.AmountOther+e.TermCountryCode+e.TermVerifRes+e.TransCurrencyCode+e.TransDate+e.TransType+e.UnpredNumber+e.AppInterProfile+e.AppTransCtr+e.CardVerifRes;var d=crypto_X919Digest(e.pdka,e.pdkb,f);return d}function emv_incrementATC(d){var c=("0000"+(parseInt(d.AppTransCtr,16)+1).toString(16));d.AppTransCtr=c.substr(c.length-4,4)}function emv_assemblePasscode(f,k){var g=f.CryptogramInfData+f.AppTransCtr+k+f.IssuerAppData;if(g.length!=f.IssuerPropBitmap.length){util_global_error_msg+="Error in emv_assemblePasscode(): Unreduced passcode data length does not equal IPB length";return null}var j=reduceHex(g,f.IssuerPropBitmap);if(j.length>13){return null}var h=parseInt(j,16).toString(10);return h}function emv_genDynPasscode(e){var f=emv_genARQC(e);if(!f){util_global_error_msg+="::Error in emv_genDynPasscode(): arqc null or undefined";return null}var d=emv_assemblePasscode(e,f);if(!d){util_global_error_msg+="::Error in emv_genDynPasscode(): pcDecimal null or undefined";return null}return d}function reduceBits(h,f){if(h.length!=f.length){return null}var g="";for(var e=0;e<f.length;e++){if(f.charAt(e)=="1"){g+=h.charAt(e)}}return g}function reduceHex(k,g){if(k.length!=g.length){return null}var h=util_hex2bitString(k);var f=util_hex2bitString(g);var j=reduceBits(h,f);return util_bitString2hex(j)}function emv_genUDK(s,m,o,l){var u="0000000000000000"+m+o;var v=u.substring(u.length-16,u.length);var n=util_flipBits(v);var p=util_hex2tstring(v);var q=util_hex2tstring(n);if(s.length==32){s+=s.substr(0,16)}var r=util_hex2tstring(s);l.a=util_tstring2hex(crypto_des(r,p,1,0));l.b=util_tstring2hex(crypto_des(r,q,1,0));return}function crypto_des(e,f,a,b,c,d){return des(e,f,a,b,c,d)}function crypto_str_sha1(a){return str_sha1(a)}var nullBlock="0000000000000000";function crypto_X919Digest(n,o,r){if(r.length%16>0){r+=nullBlock.substr(0,16-(r.length%16))}else{if(r.length==0){r=nullBlock}}var m=util_hex2tstring(n);var x=util_hex2tstring(o);var p=util_hex2tstring(r);var u=util_hex2tstring(nullBlock);var v=crypto_des(m,p,1,1,u,3);var w=crypto_des(x,v.substr(v.length-8,8),0,0);var s=crypto_des(m,w,1,0);var q=util_tstring2hex(s);return q}function crypto_mgf1(j,k){var l=new Array(4);var m;var p;var q=0;var n="";for(var o=0;q<k;o++){l[0]=((o>>24)&255);l[1]=((o>>16)&255);l[2]=((o>>8)&255);l[3]=(o&255);m=String.fromCharCode(l[0])+String.fromCharCode(l[1])+String.fromCharCode(l[2])+String.fromCharCode(l[3]);p=crypto_str_sha1(j+m);if(q+p.length>k){n+=p.substr(0,k-q);q=k}else{n+=p;q+=p.length}}return n}function crypto_randParityDES(h){var m=h.length/8;var k=((m==1||m==2||m==3)&&h.length%8==0);if(!k){return null}var j=rng_get_byte();var l=util_hex2bytes(h);for(var g=0;g<8;g++){l[g]^=((j>>g)&1)}return util_bytes2hex(l)}function mkSeedFromPwd(j){var g="",h,k;for(var f=0;f<j.length;f++){h=j.charCodeAt(f);k=(h>>8)&255;g+=(k)?String.fromCharCode(k):"";g+=String.fromCharCode(h&255)}return g}function crypto_maskDES(o,k){var h=mkSeedFromPwd(k);var j=crypto_mgf1(h,o.length/2);var m=util_hex2bytes(o);var l=util_tstring2bytes(j);for(var n=0;n<m.length;n++){m[n]^=l[n]}return util_bytes2hex(m)}function crypto_unmaskDES(d,c){return crypto_maskDES(d,c)}function crypto_camDES(d,c){if(!(d.length==8||d.length==16||d.length==24)){return null}d=crypto_randParityDES(d);d=crypto_maskDES(d,c);return d}function crypto_decamDES(d,c){if(!(d.length==8||d.length==16||d.length==24)){return null}return crypto_unmaskDES(d,c)}function crypto_cam(d,c){d=crypto_maskDES(d,c);return d}function crypto_decam(d,c){return crypto_unmaskDES(d,c)}function ACard(b){this.aotpallfields=new Array();ACard.initFields(this,ACard.fields,b)}ACard.fields={version:{name:"VER_",defValue:"0.0"},org:{name:"ORG_",defValue:""},user:{name:"USER",defValue:""},uid:{name:"UID_",defValue:""},uids:{name:"UIDS",defValue:"0001"}};ACard.initFields=function(h,g,k){var j,f;h.aotpallfields=ACard.getAllFields(k);for(j in g){f=g[j];h[j]=ACard.getField(h.aotpallfields,f.name,f.defValue,f.typ,f.excp)}return};ACard.getAllFields=function(f){var e=null;var d=new Array();if(f!=null){allflds=f.split("::");for(i=0;i<allflds.length;i++){pairs=allflds[i].split("=");e=pairs[0];if(e!=null&&e.trim().length>0){e=e.toUpperCase();d[e]=pairs[1];d.length++}}}return d};ACard.isReserved=function(c){var d=null;for(d in ACard.fields){if(c==ACard.fields[d].name){return true}}for(d in Hotp.fields){if(c==Hotp.fields[d].name){return true}}for(d in Totp.fields){if(c==Totp.fields[d].name){return true}}return false};ACard.deleteFields=function(f,e){var d;for(d in e){delete f[d]}};ACard.ParseValue=function(m,k,l,q,n){var s,r,o,p;q=q||String;m=m||"";k+="=";s=m.indexOf(k);if(s>=0){r=s+k.length;o=m.indexOf("::",r);p=m.substring(r,o)}else{if(l==undefined||l==null){throw n}p=l}return(q(p))};ACard.getField=function(n,k,j,l,m){var h=null;if(n!=null&&n[k.toUpperCase()]!=null){h=n[k.toUpperCase()];h=unescape(h)}else{if(j==undefined||j==null){h=null}else{h=j}}var o=null;if(!(l==undefined)){o=l(h)}else{o=h}return o};ACard.StringHelper=function(g,f){var h;var e="";for(h in ACard.fields){g.aotpallfields[ACard.fields[h].name]=g[h]}for(h in f){g.aotpallfields[f[h].name]=g[h]}for(h in g.aotpallfields){e+=h+"="+escape(g.aotpallfields[h])+"::"}return(e)};ACard.prototype.toString=function(){return(ACard.StringHelper(this,ACard.fields))};function Hotp(b){ACard.call(this,b);ACard.initFields(this,Hotp.fields,b)}Hotp.prototype=new ACard();Hotp.prototype.constructor=Hotp;Hotp.prototype.superclass=ACard;Hotp.fields={otptype:{name:"TYPE",defValue:"HOTP"},udk:{name:"UDK_",defValue:undefined,excp:"UDK not defined"},ctr:{name:"CTR_",defValue:0,typ:Number},digs:{name:"DIGS",defValue:6,typ:Number}};Hotp.DIGITS_POWER=new Array(10);Hotp.DIGITS_POWER[0]=1;Hotp.DIGITS_POWER[1]=10;Hotp.DIGITS_POWER[2]=100;Hotp.DIGITS_POWER[3]=1000;Hotp.DIGITS_POWER[4]=10000;Hotp.DIGITS_POWER[5]=100000;Hotp.DIGITS_POWER[6]=1000000;Hotp.DIGITS_POWER[7]=10000000;Hotp.DIGITS_POWER[8]=100000000;Hotp.DIGITS_POWER[9]=1000000000;Hotp.prototype.toString=function(){var b="";b=ACard.StringHelper(this,Hotp.fields);return b};Hotp.prototype.camouflage=function(d){if(!this.pdk){throw ("Missing plain key for camouflage")}var c=0;if(d.length>0){this.udk=this.pdk;for(c=0;c<d.length;c++){this.udk=crypto_cam(this.udk,d[c])}}return};Hotp.prototype.decamouflage=function(d){if(!this.udk){throw ("Missing camouflaged key for decamouflage")}var c=0;if(d.length>0){this.pdk=this.udk;for(c=(d.length-1);c>=0;c--){this.pdk=crypto_decam(this.pdk,d[c])}}return};Hotp.prototype.incrementCounter=function(){this.ctr+=1;return};Hotp.prototype.getCounter=function(){return(this.ctr)};Hotp.prototype.setCounter=function(b){this.ctr=parseInt(b);return};Hotp.prototype.intTo8ByteBin=function(e){var f,d="";for(f=0;f<8;f++){d=String.fromCharCode(e&255)+d;e=e>>8}return d};Hotp.prototype.genOtp=function(){if(this.pdk==null||this.pdk.length==0){throw"Key pdk_ is null, not decamouflaged"}var m=hex_hmac_sha1(util_hex2tstring(this.pdk),this.intTo8ByteBin(this.ctr));var o=util_hex2bytes(m);var p=this.digs;if(p>9){throw"digits too long"}if(p<=0){throw"digits less than 0 length"}var l=o[o.length-1]&15;var q=(o[l]&127)<<24|(o[l+1]&255)<<16|(o[l+2]&255)<<8|(o[l+3]&255);var j=Hotp.DIGITS_POWER[p];var k=q%j;var n=k.toString();while(n.length<p){n="0"+n}return n};Hotp.prototype.genDynPasscode=function(d){this.decamouflage(d);var c=this.genOtp();this.incrementCounter();return c};Hotp.prototype.genDynPasscodeAt=function(d,e){this.decamouflage(d);this.ctr=e;var f=this.genOtp();this.incrementCounter();return f};function Totp(b){Hotp.call(this,b);ACard.initFields(this,Totp.fields,b)}Totp.prototype=new Hotp("UDK_=abcd::");Totp.prototype.constructor=Totp;Totp.prototype.superclass=Hotp;Totp.fields={tvar:{name:"TVAR",defValue:0,typ:Number},tstep:{name:"TSTP",defValue:30,typ:Number}};Totp.prototype.toString=function(){var b="";b=ACard.StringHelper(this,Hotp.fields);b=ACard.StringHelper(this,Totp.fields);return b};Totp.prototype.genDynPasscode=function(f){this.decamouflage(f);var e=((new Date()).getTime())/1000;var g=(e-this.tvar)/this.tstep;this.setCounter(g);var h=this.genOtp();return h};Totp.prototype.genDynPasscodeAt=function(f,g){this.decamouflage(f);this.ctr=g;var k=Number(g)/1000;var h=(k-this.tvar)/this.tstep;this.setCounter(h);var j=this.genOtp();return j};